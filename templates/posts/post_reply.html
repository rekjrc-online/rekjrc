{% extends "base.html" %}
{% block content %}
<!-- post_reply.html -->
<div class="panel">
  <h3>Reply to Post</h3>
  <!-- Original Post Preview -->
  <div class="reply" onclick="window.location.href='/posts/{{ parent_post.uuid }}/';">
    <u>
      <strong>{{ parent_post.profile.displayname }}</strong>-
      <font size="-1">
        {{ parent_post.profile.get_profiletype_display }} - {{parent_post.insertdate|date:"m/d/y h:iA" }}
      </font>
    </u><br />
    <div style="padding-left: 10px">{{ parent_post.display_content|safe|linebreaksbr }}</div>
    {% if parent_post.image %}
      <img src="{{ parent_post.image.url }}" alt="Post image" style="max-width: 100%; height: auto" />
    {% endif %}
  </div>
  {% if not user.is_verified %}
    <p class="text-danger">
      Your account is not verified. You must verify your account before you can
      reply.
    </p>
    <a href="/humans/update/">Verify your account</a>
  {% elif profiles.count %}
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="form-group">
        <label for="{{ form.profile.uuid_for_label }}">Reply as:</label>
        {{ form.profile }}
      </div>

      <div class="form-group">
        {{ form.content }}
        <span id="char-count">200</span> characters remaining
      </div>

      <script>
        const textarea = document.getElementById(
          "{{ form.content.id_for_label }}"
        );
        const charCount = document.getElementById("char-count");
        const maxLength = 200;
        if (textarea && charCount) {
          textarea.setAttribute("maxlength", maxLength);
          textarea.addEventListener("input", () => {
            const remaining = maxLength - textarea.value.length;
            charCount.textContent = remaining;
          });
        }
      </script>

      <div class="form-group">
        <label for="{{ form.image.id_for_label }}">Image:</label>
        {{ form.image }}
      </div>

      <div class="form-group">
        <label for="{{ form.video_url.id_for_label }}">Video URL:</label>
        {{ form.video_url }}
      </div>

      <button type="submit" class="btn btn-primary">Reply</button>
    </form>
  {% else %}
  <p>
    You must create a profile before you can reply.
    <br /><br />
    <a href="/profiles/">Create a profile</a>
  </p>
  {% endif %}
</div>

<br /><br /><br /><br />
{% endblock %}
