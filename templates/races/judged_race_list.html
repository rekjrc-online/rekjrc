{% extends "base.html" %}
{% load race_filters %}
{% block content %}
<!-- judged_race_list.html -->

<div class="panel">
    <center>
        <h3>{{ race.profile.displayname }}</h3>
    </center>

    <table style="width:100%; text-align:center;" cellpadding="2" cellspacing="2">
        <tr>
            {% if is_judge and not race.race_finished %}
                <th>Action</th>
            {% endif %}
            <th>Driver</th>
            <th>Model</th>
            <th>Scored</th>
            <th>Average</th>
        </tr>
        {% for d in racedrivers %}
            <tr>
                {% if is_judge and not race.race_finished %}
                    <td>{% if d.has_scored %}âœ“{% else %}<a href="{% url 'races:judged_event_run' profile_uuid=d.driver.uuid race_uuid=race.uuid racedriver_uuid=d.uuid %}">Score</a>{% endif %}</td>
                {% endif %}
                <td>{{ d.driver.displayname }}</td>
                <td>{{ d.model.displayname }}</td>
                <td>{{ d.score_count }}/{{ race.judge_count }}</td>
                <td>
                    {% if d.score_avg %}
                        {{ d.score_avg|floatformat:2 }} avg
                    {% else %}
                        --
                    {% endif %}
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="6">No drivers signed up yet.</td>
            </tr>
        {% endfor %}
    </table>

    {% if not race.race_finished %}
        <br />
        {% if race.human == request.user %}
            <form method="post" action="{% url 'races:race_lock_toggle' profile_uuid=race.profile.uuid race_uuid=race.uuid %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary">
                    {% if race.entry_locked %}
                        Unlock Entries
                    {% else %}
                        Lock Entries
                    {% endif %}
                </button>
            </form>
            <br />
            <form method="post" action="{% url 'races:judged_event_finish' profile_uuid=race.profile.uuid race_uuid=race.uuid %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary">
                    Finish Race
                </button>
            </form>
        {% endif %}
    {% else %}
        <center><h4>- Race is Finished -</h4></center>
    {% endif %}
</div>

{% endblock %}
